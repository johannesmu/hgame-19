let windDirection=1,player=null,playerBounds=null,playerMovementRate=10,dropRate=4,playerAlive=!0,stage=null,canvas=null,info=null,payLoads=new Array;window.addEventListener("resize",()=>{canvas=resizeCanvas()}),window.addEventListener("load",()=>{canvas=resizeCanvas(),initApp(),info=document.querySelector("#info");const e=document.querySelector("#game-container").clientWidth,t=(document.querySelector("#game-container").clientHeight,document.querySelector("#main-canvas"));stage=initStage(t),setupPlayer().then(t=>{player=t,player.x=e/2,player.y=100,player.scaleX=.3,player.scaleY=.3,playerBounds=player.getTransformedBounds(),player.gotoAndPlay("fly"),stage.addChild(player),stage.update()}),getControlsConfig("data/controls.json").then(e=>{e&&window.addEventListener("keydown",t=>{const n=t.code;if(console.log(t.code),n==e.drop){if(payLoads.length<2){let e=createPayload(player);player.gotoAndPlay("dropping"),stage.addChild(e),payLoads.push(e),player.gotoAndPlay("fly")}}else n==e.down?player.y=player.y<canvas.height-playerBounds.height?player.y+playerMovementRate:player.y:n==e.up&&(player.y=player.y>60?player.y-playerMovementRate:player.y)})}).catch(()=>{});const n=initTimer(60);n.on("tick",()=>{info.innerText=n.framerate.toFixed(2),managePayLoads(payLoads,canvas,stage),n.getTicks()%100==0&&(windDirection=setWindDirection(),changeWindIndicator(document.querySelector(".wind"),windDirection)),stage.update()})});class Payload{constructor(){}}function initApp(){initStage()}function resizeCanvas(){const e=document.getElementById("game-container"),t=e.clientHeight,n=e.clientWidth,a=document.getElementById("main-canvas");return a.setAttribute("width",n),a.setAttribute("height",t-5),canvasData={instance:a,width:n,height:t},canvasData}function initStage(e){return new createjs.Stage(e)}function initTimer(e){const t=createjs.Ticker;return t.useRAF=!0,t.framerate=e,t}function setupPlayer(){return loadImage("assets/sprites/player/sprite2X.png").then(e=>{const t={images:[e],frames:{width:400,height:300},animations:{fly:[0,49],dropping:[49],dead:[7]}},n=new createjs.SpriteSheet(t),a=new createjs.Sprite(n,"fly");return new createjs.Sprite(n,a)}).catch(e=>null)}function playerDefault(){}function loadImage(e){return new Promise((t,n)=>{const a=new Image;a.addEventListener("load",()=>{t(a)}),a.addEventListener("error",e=>n(e)),a.src=e})}function getControlsConfig(e){return new Promise((t,n)=>{const a=new XMLHttpRequest;a.overrideMimeType("text/json"),a.onreadystatechange=()=>{const e=a.readyState;if(4==e||0==e)if(200==a.status){let e=!!JSON.parse(a.responseText)&&JSON.parse(a.responseText);t(e)}else n(!1)},a.open("GET",e),a.send()})}function createPayload(e){const t=e.x,n=e.y;rect=e.getTransformedBounds();const a=(new createjs.Graphics).beginFill("hsl(143Â°, 12%, 44%)").drawRect(t+.7*rect.width,n+.7*rect.height,20,10);return new createjs.Shape(a)}function managePayLoads(e,t,n){e.forEach(a=>{a.x=a.x+windDirection,a.y=a.y+dropRate;let r=a.graphics.command,i=r.x+a.x,o=r.y+a.y;if(i>t.width||i+r.w<0||o+r.h>t.height){let t=e.shift();n.removeChild(t)}})}function createTarget(){}function manageTargets(){}function setWindDirection(){const e=getRandom(100);return e<25?2:e>=25&&e<50?1:e>=50&&e<75?-1:-2}function changeWindIndicator(e,t){t>0?(e.classList.remove("left"),e.classList.add("right")):(e.classList.remove("right"),e.classList.add("left"))}function getRandom(e){return Math.round(Math.random()*e)}
//# sourceMappingURL=maps/main.min.js.map
