class Payload{constructor(e,t){this.x=e.x,this.y=e.y,this.rect=e.getTransformedBounds();let a=new createjs.Graphics;a.beginFill("olivedrab"),a.setStrokeStyle(2),a.beginStroke("white"),a.drawRect(this.x+.7*this.rect.width,this.y+.7*this.rect.height,20,10),this.sprite=new createjs.Shape(a),this.wind=t}}class Block{constructor(){this.initX=-30,this.initY=300,this.height=this.getHeight()}getHeight(){return Math.round(500*Math.random())}}function initApp(){initStage()}function resizeCanvas(){const e=document.getElementById("game-container"),t=e.clientHeight,a=e.clientWidth,n=document.getElementById("main-canvas");return n.setAttribute("width",a),n.setAttribute("height",t-5),canvasData={instance:n,width:a,height:t},canvasData}function initStage(e){return new createjs.Stage(e)}function initTimer(e){const t=createjs.Ticker;return t.useRAF=!0,t.framerate=e,t}function setupPlayer(){return loadImage("assets/sprites/player/sprite2X.png").then(e=>{const t={images:[e],frames:{width:400,height:300},animations:{fly:[0,49],dropping:[49],dead:[7]}},a=new createjs.SpriteSheet(t),n=new createjs.Sprite(a,"fly");return new createjs.Sprite(a,n)}).catch(e=>null)}function playerDefault(){}function loadImage(e){return new Promise((t,a)=>{const n=new Image;n.addEventListener("load",()=>{t(n)}),n.addEventListener("error",e=>a(e)),n.src=e})}function getControlsConfig(e){return new Promise((t,a)=>{const n=new XMLHttpRequest;n.overrideMimeType("text/json"),n.onreadystatechange=()=>{const e=n.readyState;if(4==e||0==e)if(200==n.status){let e=!!JSON.parse(n.responseText)&&JSON.parse(n.responseText);t(e)}else a(!1)},n.open("GET",e),n.send()})}function createPayload(e){const t=e.x,a=e.y;rect=e.getTransformedBounds();const n=new createjs.Graphics;return n.beginFill("white"),n.drawRect(t+.7*rect.width,a+.7*rect.height,20,10),new createjs.Shape(n)}function managePayLoads(e,t,a){e.forEach(n=>{n.sprite.x=n.sprite.x+n.wind,n.sprite.y=n.sprite.y+dropRate;let i=n.sprite.graphics.command,r=i.x+n.sprite.x,s=i.y+n.sprite.y;if(r>t.width||r+i.w<0||s+i.h>t.height){let t=e.shift();a.removeChild(t.sprite),console.log("payload removed")}})}function manageTargets(){}function setWindDirection(){const e=getRandom(100);return e<25?2:e>=25&&e<50?1:e>=50&&e<75?-1:-2}function changeWindIndicator(e,t){switch(t){case 1:e.classList.remove("left"),e.classList.add("right"),e.classList.add("half");break;case 2:e.classList.remove("left"),e.classList.remove("half"),e.classList.add("right");break;case-1:e.classList.remove("right"),e.classList.add("left"),e.classList.add("half");break;case-2:e.classList.remove("right"),e.classList.remove("half"),e.classList.add("left")}}function getRandom(e){return Math.round(Math.random()*e)}const debug=1;let windDirection=1,player=null,playerBounds=null,playerMovementRate=10,dropRate=4,playerAlive=!0,stage=null,canvas=null,info=null,payLoads=new Array;window.addEventListener("resize",()=>{canvas=resizeCanvas()}),window.addEventListener("load",()=>{canvas=resizeCanvas(),initApp(),info=document.querySelector("#info");const e=document.querySelector("#game-container").clientWidth,t=(document.querySelector("#game-container").clientHeight,document.querySelector("#main-canvas"));stage=initStage(t),setupPlayer().then(t=>{player=t,player.x=e/2,player.y=100,player.scaleX=.3,player.scaleY=.3,playerBounds=player.getTransformedBounds(),player.gotoAndPlay("fly"),stage.addChild(player),stage.update()}),getControlsConfig("data/controls.json").then(e=>{e&&window.addEventListener("keydown",t=>{const a=t.code;if(a==e.drop){if(payLoads.length<2){const e=new Payload(player,windDirection);player.gotoAndPlay("dropping"),stage.addChild(e.sprite),payLoads.push(e),player.gotoAndPlay("fly")}}else a==e.down?player.y=player.y<canvas.height-playerBounds.height?player.y+playerMovementRate:player.y:a==e.up&&(player.y=player.y>60?player.y-playerMovementRate:player.y)})}).catch(()=>{});const a=initTimer(60);a.on("tick",()=>{if(info.innerText=a.getMeasuredFPS().toFixed(2),managePayLoads(payLoads,canvas,stage),a.getTicks()%300==0){let e=windDirection,t=setWindDirection();e!=t&&(windDirection=t,console.log(windDirection),changeWindIndicator(document.querySelector(".wind"),windDirection))}stage.update()})});
//# sourceMappingURL=maps/main.min.js.map
